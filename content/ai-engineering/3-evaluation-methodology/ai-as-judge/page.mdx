# SI-baholovchi

Erkin natijali (`open-ended`) javoblarni baholashdagi qiyinchiliklar ko'plab jamoalarni inson baholashiga qaytishga majbur qildi. SI ko'plab qiyin vazifalarni avtomatlashtirishda muvaffaqiyatli qo'llanilgan ekan, u baholashni ham avtomatlashtira oladimi? SI'ni SI'ni baholash uchun ishlatish yondashuvi **SI-baholovchi** (keng tarqalgan nomi "SI — hakam" yoki `AI as a judge`) deb ataladi. Boshqa SI modellarini baholash uchun ishlatiladigan SI modeli esa **SI-baholovchi model** deb nomlanadi.[^15]

Garchi baholashni avtomatlashtirish uchun SI'dan foydalanish g'oyasi ancha vaqtdan beri mavjud bo'lsa-da,[^16] u faqat SI modellari buni uddalay oladigan darajaga yetganda, ya'ni taxminan 2020-yilda `GPT-3`'ning chiqishi bilan amaliyotga aylandi. Ushbu kitob yozilayotgan vaqtda, "SI-baholovchi" yondashuvi amaliyotdagi SI modellarini baholashning eng keng tarqalgan usullaridan biriga, balki eng keng tarqalganiga aylandi. 2023 va 2024-yillarda men ko'rgan SI baholash startaplarining aksariyat demolari u yoki bu tarzda "SI-baholovchi" yondashuvidan foydalangan. ["LangChain"ning 2023-yilgi "State of AI"](https://blog.langchain.com/langchain-state-of-ai-2023/) hisobotida ularning platformasidagi baholashlarning 58 foizi SI-baholovchilar tomonidan amalga oshirilgani qayd etilgan. "SI-baholovchi" yondashuvi, shuningdek, faol tadqiqot sohasi hamdir.

## Nima uchun SI-baholovchi?

SI-baholovchilar inson baholovchilarga nisbatan tez, ishlatishga oson va ancha arzon. Ular, shuningdek, etalon ma'lumotlarsiz ham ishlay oladi, bu esa ularni etalon ma'lumotlar mavjud bo'lmagan amaliyot muhitlarida ishlatish mumkinligini anglatadi.

Siz SI modellaridan biror natijani istalgan mezonlar asosida baholashni so'rashingiz mumkin: to'g'rilik, takrorlanuvchanlik, toksiklik, foydalilik, gallyutsinatsiyalar va hokazo. Bu xuddi biror odamdan har qanday narsa haqida o'z fikrini so'rashingizga o'xshaydi. Siz "Ammo odamlarning fikrlariga har doim ham ishonib bo'lmaydi-ku" deb o'ylashingiz mumkin. Bu to'g'ri va siz SI'ning xulosalariga ham har doim ishona olmaysiz. Biroq, har bir SI modeli ommaviy fikrlarning yig'indisi bo'lgani uchun, SI modellarining ommaviy fikrlarni aks ettiruvchi xulosalar chiqarishi mumkin. To'g'ri model uchun to'g'ri prompt bilan siz keng doiradagi mavzularda ancha yaxshi xulosalarga ega bo'lishingiz mumkin.

Tadqiqotlar shuni ko'rsatdiki, ma'lum bir SI-baholovchilar inson baholovchilari bilan kuchli bog'liqlikka ega. 2023-yilda [Zheng va boshqalar](https://arxiv.org/abs/2306.05685) o'zlarining `MT-Bench` benchmark'ida `GPT-4` va insonlar o'rtasidagi kelishuv 85% ga yetganini aniqladilar, bu hatto insonlar o'rtasidagi kelishuvdan (81%) ham yuqoridir. `AlpacaEval` mualliflari ([Dubois va boshq., 2023](https://arxiv.org/abs/2404.04475)) ham o'zlarining SI-baholovchilari insonlar tomonidan baholanadigan _LMSYS_'ning "Chat Arena" peshqadamlar jadvali bilan deyarli mukammal (0.98) korrelyatsiyaga ega ekanligini aniqladilar.

SI nafaqat javobni baholay oladi, balki o'z qarorini tushuntirib ham bera oladi, bu esa ayniqsa baholash natijalaringizni tekshirmoqchi (`audit`) bo'lganingizda foydali bo'lishi mumkin. 3-7-rasmda `GPT-4`'ning o'z xulosasini tushuntirayotganiga misol keltirilgan.

Uning moslashuvchanligi "SI-baholovchi" yondashuvini keng doiradagi dasturlar uchun foydali qiladi va ba'zi dasturlar uchun u yagona avtomatik baholash variantidir. Hatto SI xulosalari inson xulosalari kabi yaxshi bo'lmaganda ham, ular dasturning rivojlanishini yo'naltirish va loyihani boshlash uchun yetarli ishonchni ta'minlash uchun kifoya qilishi mumkin.

![3-7-rasm. SI-baholovchilar nafaqat ball qo'ya oladi, balki o'z qarorlarini ham tushuntirib bera oladi.](/ai-engineering/3-chapter/3.7-figure.png)

<div className='text-center text-sm italic'>3-7-rasm. SI-baholovchilar nafaqat ball qo'ya oladi, balki o'z qarorlarini ham tushuntirib bera oladi.</div>

## SI-baholovchidan qanday foydalanish kerak

SI'dan xulosa chiqarish uchun foydalanishning ko'plab usullari mavjud. Masalan, siz SI'dan biror javobning sifatini o'z-o'zidan baholashni, o'sha javobni etalon ma'lumotlar bilan taqqoslashni yoki o'sha javobni boshqa bir javob bilan solishtirishni so'rashingiz mumkin. Mana shu uch yondashuv uchun sodda prompt misollari:

1.  Javob sifatini o'z-o'zidan baholash (asl savol berilganda):

``` md
“Quyidagi savol va javobni hisobga olgan holda, javobning savol uchun
qanchalik yaxshi ekanligini baholang. 1 dan 5 gacha bo'lgan balldan foydalaning.
    - 1 juda yomon degani.
    - 5 juda yaxshi degani.
    Savol: [SAVOL]
    Javob: [JAVOB]
    Ball:”
```

<br/>

2.  Generatsiya qilingan javobni etalon javob bilan taqqoslash (uning bir xil yoki yo'qligini baholash uchun). Bu qo'lda ishlab chiqilgan o'xshashlik o'lchovlariga muqobil yondashuv bo'lishi mumkin:

``` md
“Quyidagi savol, etalon javob va generatsiya qilingan javobni hisobga olgan holda,
bu generatsiya qilingan javob etalon javob bilan bir xil yoki yo'qligini baholang.
True yoki False deb chiqaring.
Savol: [SAVOL]
Etalon javob: [ETALON JAVOB]
Generatsiya qilingan javob: [GENERATSIYA QILINGAN JAVOB]”
```

<br/>

3.  Ikkita generatsiya qilingan javobni taqqoslash va qaysi biri yaxshiroq ekanligini aniqlash yoki foydalanuvchilar qaysi birini afzal ko'rishini bashorat qilish. Bu qo'shimcha o'qitishni moslashtirish uchun ma'qullash ma'lumotlarini generatsiya qilish (2-bobda muhokama qilingan), _inference_ bosqichida kengaytirilgan hisoblash (2-bobda muhokama qilingan) va taqqoslashli baholash yordamida modellarni reytinglash (keyingi bo'limda muhokama qilinadi) uchun foydalidir:

``` md
“Quyidagi savol va ikkita javobni hisobga olgan holda, qaysi javob yaxshiroq
ekanligini baholang. A yoki B deb chiqaring.
Savol: [SAVOL]
A: [BIRINCHI JAVOB]
B: [IKKINCHI JAVOB]
Yaxshiroq javob:”
```

Umumiy maqsadli SI-baholovchidan biror javobni istalgan mezonlar asosida baholashni so'rash mumkin. Agar siz rol o'ynaydigan chatbot yaratsangiz, chatbotning javobi foydalanuvchilar undan o'ynashini xohlagan rolga mos keladimi yoki yo'qligini baholashni xohlashingiz mumkin, masalan, "Bu javob Gandalf aytadigan gapga o'xshaydimi?" Agar siz reklama uchun mahsulot suratlarini generatsiya qiladigan dastur yaratsangiz, "1 dan 5 gacha, bu tasvirdagi mahsulotning ishonchliligini qanday baholaysiz?" deb so'rashingiz mumkin. 3-3-jadvalda ba'zi SI vositalari tomonidan taklif qilinadigan o'rnatilgan SI-baholovchi mezonlari ko'rsatilgan.

| SI Vositalari | O'rnatilgan mezonlar |
| :--- | :--- |
| [`Azure AI Studio`](https://learn.microsoft.com/en-us/azure/ai-foundry/concepts/observability) | Asoslanganlik, relevantlik, izchillik, ravonlik, o'xshashlik |
| [`MLflow.metrics`](https://mlflow.org/docs/latest/api_reference/python_api/mlflow.metrics.html#generative-ai-metrics) | Haqiqatga moslik, relevantlik |
| [`LangChain Criteria Evaluation`](https://python.langchain.com/v0.1/docs/guides/productionization/evaluation/string/criteria_eval_chain/) | Qisqalik, relevantlik, to'g'rilik, izchillik, zararlilik, yovuz niyatlilik, foydalilik, bahslilik, misoginiya, befarqlik, jinoiylik |
| [`Ragas`](https://docs.ragas.io/en/latest/concepts/metrics/index.html) | Haqiqatga moslik, javobning relevantligi |

<div className='text-center text-sm italic'>3-3-jadval. 2024-yil sentabr holatiga ko'ra, ba'zi SI vositalari tomonidan taklif qilinadigan ichki o'rnatilgan SI-baholovchi mezonlariga misollar. Shuni unutmangki, bu vositalar rivojlangani sari, bu o'rnatilgan mezonlar ham o'zgaradi.</div>

"SI-baholovchi" mezonlari standartlashtirilmaganligini yodda tutish muhim. `Azure AI Studio`'ning relevantlik ballari `MLflow`'ning relevantlik ballaridan juda farq qilishi mumkin. Bu ballar baholovchining asosiy modeliga va promptiga bog'liq.

### SI-baholovchi uchun prompt yozish

SI-baholovchi uchun prompt yozish har qanday SI dasturi uchun prompt yozishga o'xshaydi. Umuman olganda, baholovchining prompti quyidagilarni aniq tushuntirishi kerak:

- **Model bajarishi kerak bo'lgan vazifa,** masalan, generatsiya qilingan javob va savol o'rtasidagi relevantlikni baholash.
- **Model baholash uchun amal qilishi kerak bo'lgan mezonlar,** masalan, "Sizning asosiy e'tiboringiz generatsiya qilingan javob etalon haqiqat (`ground truth`) javobiga ko'ra berilgan savolni hal qilish uchun yetarli ma'lumotni o'z ichiga oladimi yoki yo'qligini aniqlashga qaratilishi kerak". Ko'rsatma qanchalik batafsil bo'lsa, shuncha yaxshi.
- **Ballash tizimi,** u quyidagilardan biri bo'lishi mumkin:
    - **Tasniflash,** masalan, yaxshi/yomon yoki relevant/relevant emas/neytral.
    - **Diskret sonli qiymatlar,** masalan, 1 dan 5 gacha. Diskret sonli qiymatlarni tasniflashning maxsus holi deb hisoblash mumkin, bunda har bir sinf semantik talqin o'rniga sonli talqinga ega.
    - **Uzluksiz sonli qiymatlar,** masalan, 0 va 1 oralig'ida, masalan, o'xshashlik darajasini baholamoqchi bo'lganingizda.

> **Maslahat** <br/>
> Til modellari odatda sonlarga qaraganda matn bilan yaxshiroq ishlaydi. Ma'lum qilinishicha, SI-baholovchilar sonli ballash tizimlariga qaraganda tasniflash bilan yaxshiroq ishlaydi.
>
> Sonli ballash tizimlari uchun diskret ballash uzluksiz ballashdan ko'ra yaxshiroq ishlaydiganga o'xshaydi. Amalda, diskret ballash uchun diapazon qanchalik keng bo'lsa, model shunchalik yomonlashadiganga o'xshaydi. Odatdagi diskret ballash tizimlari 1 dan 5 gacha bo'ladi.

Misollar bilan boyitilgan promptlar yaxshiroq ishlashi isbotlangan. Agar siz 1 dan 5 gacha bo'lgan ballash tizimidan foydalansangiz, 1, 2, 3, 4 yoki 5 ballga ega bo'lgan javob qanday ko'rinishda bo'lishiga misollar keltiring va iloji bo'lsa, nima uchun javob ma'lum bir ball olganini ham tushuntiring. _Prompting_ uchun eng yaxshi amaliyotlar 5-bobda muhokama qilinadi.

Quyida "Azure AI Studio" tomonidan [_relevantlik_](https://learn.microsoft.com/en-us/azure/ai-foundry/concepts/observability) mezoni uchun ishlatilgan promptning bir qismi keltirilgan. U vazifani, mezonlarni, ballash tizimini, past ballga ega bo'lgan kirish ma'lumotiga misolni va nima uchun bu kirish ma'lumoti past ballga ega ekanligining asoslanishini tushuntiradi. Promptning bir qismi qisqalik uchun olib tashlangan.

``` md
`Sizning vazifangiz — generatsiya qilingan javob va savol o'rtasidagi
relevantlikni etalon haqiqat javobiga asoslanib, 1 dan 5 gacha
bo'lgan oraliqda baholash va iltimos, baholash sababini ham taqdim eting.

Sizning asosiy e'tiboringiz generatsiya qilingan javob etalon haqiqat
javobiga ko'ra berilgan savolni hal qilish uchun yetarli ma'lumotni o'z
ichiga oladimi yoki yo'qligini aniqlashga qaratilishi kerak. …

Agar generatsiya qilingan javob etalon haqiqat javobiga zid bo'lsa, u 1-2
past ball oladi.

Masalan, "Osmon ko'kmi?" savoli uchun etalon haqiqat javobi "Ha, osmon
ko'k." va generatsiya qilingan javob "Yo'q, osmon ko'k emas."

Ushbu misolda, generatsiya qilingan javob aslida osmon ko'k bo'lsa-da,
osmon ko'k emasligini aytib, etalon haqiqat javobiga zid kelmoqda.

Bu nomuvofiqlik 1-2 past ballga olib keladi va past ballning sababi
generatsiya qilingan javob va etalon haqiqat javobi o'rtasidagi ziddiyatni
aks ettiradi.`
```

3-8-rasmda savol berilganda javobning sifatini baholaydigan SI-baholovchiga misol ko'rsatilgan.

![3-8-rasm. Savol berilganda javobning sifatini baholaydigan SI-baholovchiga misol.](/ai-engineering/3-chapter/3.8-figure.png)

<div className='text-center text-sm italic'>3-8-rasm. Savol berilganda javobning sifatini baholaydigan SI-baholovchiga misol.</div>

SI-baholovchi — bu shunchaki model emas, u ham modelni, ham promptni o'z ichiga olgan tizimdir. Modelni, promptni yoki modelning _sampling_ parametrlarini o'zgartirish boshqa bir baholovchiga olib keladi.

### Izohlar 

[^15]: "SI-baholovchi" atamasini SI'ning sudda hakam sifatida ishlatilishi qo'llanish holati bilan adashtirmaslik kerak.

[^16]: 2017-yilda men `NeurIPS` seminarida _MEWR_ (Machine translation Evaluation metric Without Reference text) — mashina tarjimalarini avtomatik baholash uchun kuchliroq til modellaridan foydalanadigan baholash usulini taqdim etganman. Afsuski, hayotiy sabablarga ko'ra bu tadqiqot yo'nalishini hech qachon davom ettirmadim.

[^17]: Ba'zi hollarda, baholash byudjetning asosiy qismini, hatto javob generatsiyasidan ham ko'proqni egallashi mumkin.

[^18]: "Spot-checking" _sampling_ bilan bir xil.

[^19]: Saito va boshqalar (2023) insonlar ham uzunroq javoblarni afzal ko'rishlarini, ammo ancha kamroq darajada ekanligini aniqladilar.

[^20]: Bu texnika ba'zan o'z-o'zini tanqid qilish (`self-critique`) yoki o'z-o'zidan so'rash (`self-ask`) deb ataladi.

[^21]: `BLEURT` ballar diapazoni chalkash. U taxminan -2.5 va 1.0 oralig'ida. Bu SI-baholovchilar bilan benchmark'ning noaniqligi muammosini ko'rsatadi: ballar diapazoni ixtiyoriy bo'lishi mumkin.

[^22]: Masalan, Likert shkalasidan foydalanish.

[^23]: Garchi Chatbot Arena Elo reyting algoritmidan foydalanishni to'xtatgan bo'lsa-da, uning ishlab chiquvchilari bir muncha vaqt o'zlarining model reytinglarini "Elo ballari" deb atashda davom etishdi. Ular natijaviy Bredli-Terri ballarini Elo ballariga o'xshatish uchun miqyoslashdi. Miqyoslash ancha murakkab. Har bir ball 400 ga (Elo'da ishlatiladigan shkala) ko'paytiriladi va 1000 ga (boshlang'ich Elo bali) qo'shiladi. Keyin bu ball `Llama-13b` modeli 800 ballga ega bo'lishi uchun qayta miqyoslanadi.

[^24]: Chatbot Arena ommalashgani sari, uni aldashga urinishlar ham ko'payib bormoqda. Garchi hech kim menga reytingni aldashga uringanini tan olmagan bo'lsa-da, bir nechta model ishlab chiquvchilari o'z raqobatchilari uni aldashga harakat qilishiga amin ekanliklarini aytishdi.